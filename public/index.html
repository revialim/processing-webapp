<html>
<head>
    <title> Processing Web App </title>
    <link rel="stylesheet" type="text/css" href="./style.css">
    <script src="./processing.js"></script>
    <script src="./jquery-3.1.1.min.js"></script>
    <script>
        //cube initial setup
        window.CubeContainer = {
            alias: "genericCubeAlias",
            boxX : 100,
            boxY : 100,
            cubeSize : 90,
            rotX : 0.5,
            rotY : 0.5
        }
        //list of all cubes
        var allCubes;
        
        function allCubesIntoHTML(cubes){
            var cubeHTML = "";
            var num = 1;
            
            cubes.forEach(function(cube) {
                    cubeHTML = cubeHTML + "<div>"+ num +"</div>"+
                        "<button onclick=\"showCube('"+ cube._id +"')\"> Show </button>"+
                        "<ul><li>" + cube._id +"</li>"+
                        "<li> Alias: "+ cube.alias +"</li>"+
                        "<li> x-coordinate: "+ cube.boxX +"</li>"+
                        "<li> y-coordinate: "+ cube.boxY +"</li>"+
                        "<li> cube size: "+ cube.cubeSize +"</li>"+
                        "<li> rotation x: "+ cube.rotX + "</li>"+
                        "<li> rotation y: "+ cube.rotY +"</li></ul>";
                    num = num + 1;
                });
                
            document.getElementById('saved-cubes-list').innerHTML = cubeHTML;
        }
        
        //get alias from input field
        function updateAlias() {
            CubeContainer.alias = document.getElementById('cubeAlias').value;
            document.getElementById("cube-alias-input").innerHTML = "Alias was set to: "+ CubeContainer.alias;
        }
        
        //update cube list, find all cubes in DB
        function updateCubeList() {
            console.log("getting list of cubes");
            
            var request = $.ajax({
                type: "GET",
                url: "/cubes",
                contentType: "text"
            });
            request.done(function(response){
                //console.log("allcubes: "+response);
                allCubes = response;
                // add updated information to DOM
                allCubesIntoHTML(response);
            });
        }
        
        //post button values
        function postValues() {
            console.log("posting values");
            $.ajax({
                type: "POST",
             // method: "POST",
                url: "/cubes",
                processData: false,
                contentType: "application/json",
                data: JSON.stringify(CubeContainer)
             // dataType: "json"   
            }).done(function() {
                console.log("Cube Data was saved.");
                updateCubeList();
            });
        }
        
        //show cube, when button clicked
        function showCube(id) {
            //search for cube with correct id in allCubes list
            //search field "_id"
            allCubes.forEach(function(cube){
                if(cube._id === id){
                    CubeContainer.alias = cube.alias;
                    CubeContainer.boxX = cube.boxX;
                    CubeContainer.boxY = cube.boxY;
                    CubeContainer.cubeSize = cube.cubeSize;
                    CubeContainer.rotX = cube.rotX;
                    CubeContainer.rotY = cube.rotY;
                }
            });
        }
        
        //TODO: set slider function, so that sliders show CubeContainer values
        
        window.onload = updateCubeList;
    </script>
</head>
<body>
<h1> Processing Web App </h1>

<h2> Cube </h2>	
    
<canvas id="testcanvas"></canvas>
    
<script id="script1" type="text/javascript">
    // Attaching js code to the canvas by using a sketch object
    var sketch = new Processing.Sketch();
    
    // define 3D context
    sketch.use3DContext = true;
    // attach function (also, can be specified as the single parameter 
    // in the Processing.Sketch object constructor)
    sketch.attachFunction = function(processing) {
        
        processing.setup = function() {
            processing.size(400, 400, processing.P3D);
            processing.fill(8);
            processing.stroke(200);
            processing.strokeWeight(2);
        };

        processing.draw = function() {
            processing.background(240);
            //draw a 3d box
            processing.translate(CubeContainer.boxX, CubeContainer.boxY, 0); 
            processing.rotateY(CubeContainer.rotY);
            processing.rotateX(CubeContainer.rotX);
            processing.box(CubeContainer.cubeSize);
        };
        
        // mouse event
        
        processing.mouseDragged = function() {
            var rate = 0.01;
            CubeContainer.rotX += (processing.pmouseY-processing.mouseY) * rate;
            CubeContainer.rotY += (processing.mouseX-processing.pmouseX) * rate;
        };
        
    };
    
    function setValue(elem, i) {
        if(elem.id === "boxPosX") {
            CubeContainer.boxX = i;
        } else if(elem.id === "boxPosY") {
            CubeContainer.boxY = i;
        } else if (elem.id === "cubeSize") {
            CubeContainer.cubeSize = i;
        } else if (elem.id === "rotationX") {
            CubeContainer.rotX = i;
        } else if (elem.id === "rotationY") {
            CubeContainer.rotY = i;
        }
    }
    
    // attaching the sketchProc function to the canvas
    var canvas = document.getElementById("testcanvas");
    var p = new Processing(canvas, sketch);

</script>
    
<div class="cube-inputs-wrap">
    <div class="cube-input">x-coordinate: 
    <input type="range" id="boxPosX" min="0" max="400" oninput="setValue(this, this.value);" onchange="setValue(this, this.value);"></div>
    <div class="cube-input">y-coordinate: 
    <input type="range" id="boxPosY" min="0" max="400" oninput="setValue(this, this.value);" onchange="setValue(this, this.value);"></div>
    <div class="cube-input">Cube size: 
    <input type="range" id="cubeSize" min="10" max="280" oninput="setValue(this, this.value);" onchange="setValue(this, this.value);"></div>
    <div class="cube-input">Rotation x: 
    <input type="range" id="rotationX" min="0" max="6.3" step="0.01" oninput="setValue(this, this.value);" onchange="setValue(this, this.value);"></div>
    <div class="cube-input">Rotation y: 
    <input type="range" id="rotationY" min="0" max="6.3" step="0.01" oninput="setValue(this, this.value);" onchange="setValue(this, this.value);"></div>
    <div class="cube-input">Cube Alias: <input type="text" id="cubeAlias" >
        <button onclick="updateAlias()">Enter alias</button>
        <div id="cube-alias-input">alias is set to generic value</div>    
    </div>
</div>
    
<div>
<button onclick="postValues()">Save cube settings</button>
</div>
    
<div id="saved-cubes-list"></div>
    
</body>
</html>